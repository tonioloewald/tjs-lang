{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "TJS",
  "scopeName": "source.tjs",
  "patterns": [
    {
      "include": "#comments"
    },
    {
      "include": "#strings"
    },
    {
      "include": "#test-block"
    },
    {
      "include": "#mock-block"
    },
    {
      "include": "#unsafe-block"
    },
    {
      "include": "#function-def"
    },
    {
      "include": "#return-type"
    },
    {
      "include": "#forbidden"
    },
    {
      "include": "#keywords"
    },
    {
      "include": "#builtins"
    },
    {
      "include": "#type-parameters"
    },
    {
      "include": "#numbers"
    },
    {
      "include": "#operators"
    }
  ],
  "repository": {
    "test-block": {
      "begin": "\\b(test)\\s*\\(\\s*(['\"`])([^'\"`]*)(\\2)\\s*\\)\\s*\\{",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.test.tjs"
        },
        "2": {
          "name": "punctuation.definition.string.begin.tjs"
        },
        "3": {
          "name": "string.quoted.test-description.tjs"
        },
        "4": {
          "name": "punctuation.definition.string.end.tjs"
        }
      },
      "end": "\\}",
      "patterns": [
        {
          "include": "$self"
        }
      ]
    },
    "mock-block": {
      "begin": "\\b(mock)\\s*\\{",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.mock.tjs"
        }
      },
      "end": "\\}",
      "patterns": [
        {
          "include": "$self"
        }
      ]
    },
    "unsafe-block": {
      "begin": "\\b(unsafe)\\s*\\{",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.unsafe.tjs"
        }
      },
      "end": "\\}",
      "patterns": [
        {
          "include": "$self"
        }
      ]
    },
    "return-type": {
      "match": "\\)\\s*(->)\\s*(\\{[^}]+\\}|'[^']*'|\"[^\"]*\"|\\[[^\\]]*\\]|\\w+)",
      "captures": {
        "1": {
          "name": "keyword.operator.return-type.tjs"
        },
        "2": {
          "name": "support.type.return.tjs"
        }
      }
    },
    "function-def": {
      "begin": "\\b(async\\s+)?(function)\\s+([a-zA-Z_$][a-zA-Z0-9_$]*)\\s*\\(",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.async.tjs"
        },
        "2": {
          "name": "keyword.control.tjs"
        },
        "3": {
          "name": "entity.name.function.tjs"
        }
      },
      "end": "\\)",
      "patterns": [
        {
          "include": "#type-parameters"
        },
        {
          "include": "#comments"
        }
      ]
    },
    "type-parameters": {
      "patterns": [
        {
          "comment": "Required parameter with type: name: 'string' or name: 0",
          "match": "([a-zA-Z_$][a-zA-Z0-9_$]*)\\s*(:)\\s*('[^']*'|\"[^\"]*\"|\\d+|\\{[^}]*\\}|\\[[^\\]]*\\]|true|false|null)",
          "captures": {
            "1": {
              "name": "variable.parameter.tjs"
            },
            "2": {
              "name": "punctuation.separator.type.tjs"
            },
            "3": {
              "name": "support.type.tjs"
            }
          }
        },
        {
          "comment": "Optional parameter with default: name = value",
          "match": "([a-zA-Z_$][a-zA-Z0-9_$]*)\\s*(=)\\s*(?=null\\s*&&|'|\"|\\d|\\{|\\[|true|false|null)",
          "captures": {
            "1": {
              "name": "variable.parameter.tjs"
            },
            "2": {
              "name": "keyword.operator.assignment.tjs"
            }
          }
        },
        {
          "comment": "Simple parameter name",
          "match": "([a-zA-Z_$][a-zA-Z0-9_$]*)(?=\\s*[,)])",
          "captures": {
            "1": {
              "name": "variable.parameter.tjs"
            }
          }
        }
      ]
    },
    "forbidden": {
      "patterns": [
        {
          "match": "\\\\b(implements|interface|abstract|private|protected|public|yield|require|module|var|switch|case|default|with|void|debugger|eval|type|enum|namespace|declare|readonly|as|is|keyof|infer|never|unknown)\\\\b",
          "name": "invalid.illegal.forbidden.tjs"
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "match": "\\\\b(function|return|if|else|while|for|of|in|try|catch|finally|let|const|test|mock|unsafe|async|await|throw|import|export|class|extends|super|this|new|static|typeof|instanceof|delete)\\\\b",
          "name": "keyword.control.tjs"
        },
        {
          "match": "\\\\b(true|false|null|undefined)\\\\b",
          "name": "constant.language.tjs"
        }
      ]
    },
    "builtins": {
      "patterns": [
        {
          "match": "\\\\b(Date|Set|Map|Array|Object|String|Number|Boolean|RegExp|Error|JSON|Math|Schema|expect|assert)\\\\b",
          "name": "support.class.tjs"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.single.tjs",
          "begin": "'",
          "end": "'",
          "patterns": [
            {
              "name": "constant.character.escape.tjs",
              "match": "\\\\."
            }
          ]
        },
        {
          "name": "string.quoted.double.tjs",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.tjs",
              "match": "\\\\."
            }
          ]
        },
        {
          "name": "string.template.tjs",
          "begin": "`",
          "end": "`",
          "patterns": [
            {
              "name": "constant.character.escape.tjs",
              "match": "\\\\."
            },
            {
              "name": "meta.template.expression.tjs",
              "begin": "\\$\\{",
              "end": "\\}",
              "beginCaptures": {
                "0": {
                  "name": "punctuation.definition.template-expression.begin.tjs"
                }
              },
              "endCaptures": {
                "0": {
                  "name": "punctuation.definition.template-expression.end.tjs"
                }
              },
              "patterns": [
                {
                  "include": "$self"
                }
              ]
            }
          ]
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "match": "\\b\\d+\\.\\d+([eE][+-]?\\d+)?\\b",
          "name": "constant.numeric.float.tjs"
        },
        {
          "match": "\\b\\d+\\b",
          "name": "constant.numeric.integer.tjs"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "match": "->",
          "name": "keyword.operator.return-type.tjs"
        },
        {
          "match": "\\?\\?|&&|\\|\\||!|===|!==|==|!=|>=|<=|>|<",
          "name": "keyword.operator.logical.tjs"
        },
        {
          "match": "\\+|\\-|\\*|\\/|%|\\*\\*",
          "name": "keyword.operator.arithmetic.tjs"
        },
        {
          "match": "=",
          "name": "keyword.operator.assignment.tjs"
        },
        {
          "match": "\\?\\.?",
          "name": "keyword.operator.optional.tjs"
        }
      ]
    },
    "comments": {
      "patterns": [
        {
          "name": "comment.line.double-slash.tjs",
          "match": "//.*$"
        },
        {
          "name": "comment.block.documentation.tjs",
          "begin": "/\\*\\*",
          "end": "\\*/",
          "patterns": [
            {
              "match": "@(param|returns?|description|example)\\b",
              "name": "keyword.other.documentation.tjs"
            }
          ]
        },
        {
          "comment": "Non-JSDoc block comments - could add markdown highlighting here",
          "name": "comment.block.markdown.tjs",
          "begin": "/\\*(?!\\*)",
          "end": "\\*/",
          "patterns": [
            {
              "match": "(^|\\s)(#{1,6})\\s+.*$",
              "name": "markup.heading.markdown.tjs"
            },
            {
              "match": "\\*\\*[^*]+\\*\\*",
              "name": "markup.bold.markdown.tjs"
            },
            {
              "match": "`[^`]+`",
              "name": "markup.inline.raw.markdown.tjs"
            }
          ]
        }
      ]
    }
  }
}
